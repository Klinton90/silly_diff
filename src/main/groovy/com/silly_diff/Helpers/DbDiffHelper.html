<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- **************************************************************** -->
<!-- *  PLEASE KEEP COMPLICATED EXPRESSIONS OUT OF THESE TEMPLATES, * -->
<!-- *  i.e. only iterate & print data where possible. Thanks, Jez. * -->
<!-- **************************************************************** -->

<html>
<head>
    <!-- Generated by groovydoc (2.3.9) on Mon Apr 11 23:12:19 EDT 2016 -->
    <title>DbDiffHelper (Groovy Documentation)</title>
    <meta name="date" content="2016-04-11">
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <link href="../../../../../../groovy.ico" type="image/x-icon" rel="shortcut icon">
    <link href="../../../../../../groovy.ico" type="image/x-icon" rel="icon">
    <link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">

<body class="center">
<script type="text/javascript"><!--
if (location.href.indexOf('is-external=true') == -1) {
    parent.document.title="DbDiffHelper (Groovy Documentation)";
}
//-->
</script>
<noscript>
    <div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
    <!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../../index-all.html">Index</a></li>
        <li><a href="../../../../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../../../../index.html?src/main/groovy/com/silly_diff/Helpers/DbDiffHelper" target="_top">Frames</a></li>
            <li><a href="DbDiffHelper.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;<li><a href="#field_summary">Field</a></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#constructor_summary">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            <li><a href="#field_detail">Field</a></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#constructor_detail">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <a name="skip-navbar_top">
        <!--   -->
    </a></div>
<!-- ========= END OF TOP NAVBAR ========= -->

<!-- ======== START OF CLASS DATA ======== -->
<div class="header">

    <div class="subTitle">Package: <strong>src.main.groovy.com.silly_diff.Helpers</strong></div>

    <h2 title="[Groovy] Class DbDiffHelper" class="title">[Groovy] Class DbDiffHelper</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><ul class="inheritance"></ul></li><li><ul class="inheritance"></ul></li><li>src.main.groovy.com.silly_diff.Helpers.DbDiffHelper
</ul>
<div class="description">
    <ul class="blockList">
        <li class="blockList">



    <p> Some useful hints for this helper<br>
 ***********************************************************<br>
 For comparing DB with XML that has complicate structure use aliases for columns.<br>
 Use NodeNames from XmlTree in aliases, every NodeName should be separated with "." (dot).<br>
 AttributeNames should be wrapped with "@" symbol.<br>
 Nodes with the same names under the same parent, additionally should be marked with ">{unique_name}" badge<br>
 ***********************************************************<br>
 Some examples:<br>
 <ul>
  <li>
 1) Unique names for Nodes: <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer&gt; 
         &lt;En&gt; 
             &lt;name&gt;DName1&lt;/name&gt; 
             &lt;address&gt;DAddress1&lt;/address&gt; 
         &lt;/En&gt; 
         &lt;Fr&gt; 
             &lt;name&gt;DName1&lt;/name&gt; 
             &lt;address&gt;DAddress1&lt;/address&gt; 
         &lt;/Fr&gt; 
     &lt;/dealer&gt; 
 &lt;/data&gt; 
 SELECT 
  `nameEn` AS "En.name", 
  `addressEn` AS "En.address", 
  `nameFr` AS "Fr.name", 
  `addressFr` AS "Fr.address" 
 FROM DEALERS;
 </CODE></pre>
  </li>
  <li>
 2) Attributes: <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer pos="pos1"&gt; 
         &lt;name value="Name1"&gt; 
         &lt;address value="Address1"&gt; 
    &lt;/dealer&gt; 
 &lt;/data&gt; 
 SELECT 
  `pos` AS "@pos", 
  `name` AS "name.@value", 
  `address` AS "address.@value" 
 FROM DEALERS;
 </CODE></pre>
  </li>
  <li>
 3) Nodes with same name under the one parent <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer&gt; 
         &lt;Name&gt;Name1&lt;/Name&gt; 
         &lt;SpecialProperties count="2"&gt; 
             &lt;property attr="1"&gt;NCV&lt;/property&gt; 
             &lt;property attr="2"&gt;Leaf&lt;/property&gt; 
         &lt;/SpecialProperties&gt; 
     &lt;dealer&gt; 
 &lt;/data&gt; 
 SELECT 
  d.`name` AS "Name", 
  IF(ncv.`Description` IS NULL, 0, 1) + IF(leaf.`Description` IS NULL, 0, 1) AS "SpecialProperties.@count", 
  ncv.`Description` AS "SpecialProperties.property.&gt;1", 
  ncv.`FakeAttr` AS "SpecialProperties.property.&gt;1.@attr", 
  leaf.`Description` AS "SpecialProperties.property.&gt;2", 
  leaf.`FakeAttr` AS "SpecialProperties.property.&gt;2.@attr" 
 FROM DEALERS AS d 
 LEFT JOIN DEALER_SPECIAL AS ncv ON ncv.DealerId = d.DealerId AND ncv.Description = "NCV" 
 LEFT JOIN DEALER_SPECIAL AS ncv ON leaf.DealerId = d.DealerId AND leaf.Description = "Leaf";
 </CODE></pre>
  </li>
 </ul>
 ***********************************************************<br>
 You can exclude some Columns or Nodes from comparison.<br>
 Use "ignoredValue" variable to set value that will be compared with DB value.<br>
 By default ignoredValue = "ignore".<br>
 E.g. <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer IgnoredAttr="bla-bla"&gt; 
         &lt;NAME&gt;name&lt;NAME&gt; 
     &lt;/dealer&gt; 
 &lt;/data&gt; 
 SELECT "name" AS "NAME", "ignore" AS "@IgnoredAttr";
 </CODE></pre>
 Selected row and XML matches, as "IgnoredAttr" will be excluded from comparison<br>
 ***********************************************************<br>
 By default CalcDiff() function works in "OrderlySafe" mode. It means, that nodes in Lists will be compared in exact order.<br>
 You can change that by setting <CODE>orderlySafeMode == false</CODE><br>
 For example: <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer attr="val1"&gt; 
     &lt;dealer attr="val2"&gt; 
     &lt;dealer attr="val3"&gt; 
 &lt;/data&gt; 
 SELECT "val2" AS "@attr" 
 UNION 
 SELECT "val1" AS "@attr" 
 UNION 
 SELECT "val3" AS "@attr"
 </CODE></pre>
 <ul>
     <li>
      1)  <CODE>orderlySafeMode = false; // Default</CODE><br>
          Result: Xml and DbResult match. No differences where found.<br>
     </li>
     <li>
      2)  <CODE>orderlySafeMode = true;</CODE><br>
          Result: Only attr="val3" matches. attr="val1" and attr="val2" are marked as differences.<br>
     </li>
 </ul>
 ***********************************************************<br>
 By default CompareNodes() function works in "NonOrderlySafe" mode. It means, that nodes with same name under one parent<br>
 will be compared without checking order of unique identifier.<br>
 Always use this mode, if your XML may have different number of nodes with same name under one parent.<br>
 You can change that by setting <CODE>orderlySafeArrayMode == true</CODE><br>
 For example: <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer attr="val1"&gt; 
         &lt;property&gt;PreOwned&lt;property&gt; 
         &lt;property&gt;NCV&lt;property&gt;
         &lt;property&gt;Leaf&lt;property&gt;
     &lt;dealer&gt;
 &lt;/data&gt;
 SELECT
  "val1" AS "@attr"
  po.`Description` AS "property.&gt;match",
  NULL AS "property.&gt;fake"
  leaf.`Description` AS "property.&gt;1",
  ncv.`Description` AS "property.&gt;2"
 FROM DEALERS AS p
 LEFT JOIN DEALER_SPECIAL AS ncv ON ncv.DealerId = d.DealerId AND ncv.Description = "NCV"
 LEFT JOIN DEALER_SPECIAL AS leaf ON leaf.DealerId = d.DealerId AND leaf.Description = "Leaf"
 LEFT JOIN DEALER_SPECIAL AS po ON po.DealerId = d.DealerId AND po.Description = "PreOwned";
 </CODE></pre>
 <ul>
     <li>
      1)  <CODE>orderlySafeArrayMode = false; // Default</CODE><br>
          Result: Xml and DbResult match. No differences where found.<br>
     </li>
     <li>
      2)  <CODE>orderlySafeArrayMode = true;</CODE><br>
          Result: Only <property>PreOwned<property> matches. <property>NCV<property> and <property>Leaf<property> are marked as differences.<br>
     </li>
 </ul>
 ***********************************************************<br>
 When XML may delete some Nodes if those nodes doesn't have value, DB must return NULL value for these nodes.<br>
 If your XML should NOT delete Nodes, and you want to Tests it, DB must return <CODE>String#EmptyString</CODE> or 1 <CODE>SPACE</CODE> character.<br>
 <CODE>SPACE</CODE> hack is required for ORACLE DB, that returns null instead of <CODE>String#EmptyString</CODE>.<br>
 When XML node should appear in XmlTree, but doesn't have value, both NULL and String.Empty will match with Node.<br>
 Same thing works for attributes.<br>
 For example:<br>
 <pre><CODE>&lt;dealers&gt;
     &lt;dealer&gt;
         &lt;name&gt;Name1&lt;/name&gt;
         &lt;address&gt;Address1&lt;/address&gt;
         &lt;phone&gt;Phone1&lt;/phone&gt;
     &lt;/dealer&gt;
     &lt;dealer&gt;
         &lt;name&gt;Name2&lt;/name&gt;
         &lt;phone&gt;Phone1&lt;/phone&gt;
     &lt;/dealer&gt;
     &lt;dealer&gt;
         &lt;name&gt;Name3&lt;/name&gt;
         &lt;address&gt;Address3&lt;/address&gt;
     &lt;/dealer&gt;
 &lt;/dealers&gt;
 SELECT `name`,
         IF(`address` = "" OR `address` IS NULL, NULL, `address`) AS "address",
         IF(`phone` = "" OR `phone` IS NULL, "", `phone`) AS "phone"
 FROM DEALERS;
 </CODE></pre>
 <ul>
  <li>Dealer1 - matches.</li>
  <li>Dealer2 - matches even in case when "address" Node doesn't exists, as system will skip DB columns with NULL value.</li>
  <li>Dealer3 - does NOT match, because or DB column contains String.Empty value, that indicates, that Node with same name must appear in XML.</li>
 </ul>
 ***********************************************************<br>
 Note! You may skip columns from DB query if Nodes in XML are always empty.<br>
 It applies to every node with children, but without own TextValue.<br>
 For example:<br>
 <pre><CODE>&lt;dealers&gt;
     &lt;dealer&gt;
         &lt;SpecialProperties attr="attr2"&gt;
             &lt;some1&gt;val1&lt;some1&gt;
         &lt;/SpecialProperties&gt;
     &lt;dealer&gt;
 &lt;/dealers&gt;
 SELECT  `attr` AS "SpecialProperties.@attr"
         `some1` AS "SpecialProperties.some1"
 FROM DEALERS;
 </CODE></pre>
 DB query doesn't return any values for "dealer" and "SpecialProperties" nodes.<br>
 But DB and XML match anyway as empty XML nodes without TextValue are skipped.<br>
 ***********************************************************<br>
 NOTE! All fields in DB ResultSet that starts with "_" will be skipped during comparison.<br>
 You can use this pattern for providing additional parameters to SubQuery.<br>
 For more information please refer to <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/DbDiffHelper.html#includedNodes' title='DbDiffHelper.includedNodes'>DbDiffHelper.includedNodes</a> parameter description.<br>
 ***********************************************************<br>
 To create XmlTreeMap (list of column names) for DB query, use static function<br> <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/DbDiffHelper.html#mapXml(NodeChild node, String prefix = "")' title='DbDiffHelper.mapXml'>DbDiffHelper.mapXml</a>
 that consumes 1 parameter NodeChild,<br>
 which is XML that you are going to use for comparing with each DbRow.<br>
 Second parameter String<DL><DT><B>prefix:</B></DT><DD>should not be used in most cases,<br>
 as it is used by function itself for recursive mapping.<br>
 ***********************************************************<br>
 Use these statements to Tests mapXml creation (new "xmlMap.txt" file with XmlTreeMap will be created in "/output" folder):<br>
 <pre><CODE>public Tests(){
  NodeChild qaXML = (NodeChild)new XmlSlurper().parse(new File(props.outputDir+"/example/incentive.xml"));
  new File(outputLocation,"xmlMap.txt").withWriter{writer -&gt; writer.write(DbDiffHelper.mapXml(XmlDiffHelper.walkXmlByPath(listPath, qaXML)[0]))</CODE>;
 }
 }</pre>
 ***********************************************************<br>
 Use these statements to Tests ArrayMatching (case when few nodes with same name located under the same parent):<br>
 <pre><CODE>public Tests(){
  String queryTest = """
                        SELECT 
                          NULL AS "some3", 
                          NULL AS "some3.@attr",
                          NULL AS "some2",
                          "" AS "some",
                          "abc1" AS "@count",
                          "qwe1-1" AS "property.&gt;1.@attr",
                          "qwe1-2" AS "property.&gt;2.@attr",
                          "zxc1-1-1" AS "property.&gt;1.value.&gt;1",
                          "zxc1-1-2" AS "property.&gt;1.value.&gt;2",
                          "zxc1-2-1" AS "property.&gt;2.value.&gt;1",
                          "zxc1-2-2" AS "property.&gt;2.value.&gt;2",
                          "rty1-1-1" AS "property.&gt;1.value.&gt;1.@attr",
                          "rty1-1-2" AS "property.&gt;1.value.&gt;2.@attr",
                          "rty1-2-1" AS "property.&gt;2.value.&gt;1.@attr",
                          "rty1-2-2" AS "property.&gt;2.value.&gt;2.@attr"
                       UNION
                       SELECT
                          "" AS "some3",
                          "val" AS "some3.@attr",
                          "" AS "some2",
                          "" AS "some",
                          "abc2" AS "@count",
                          "qwe2-1" AS "property.&gt;1.@attr",
                          "qwe2-2" AS "property.&gt;2.@attr",
                          "zxc2-1-1" AS "property.&gt;1.value.&gt;1",
                          "zxc2-1-2" AS "property.&gt;1.value.&gt;2",
                          "zxc2-2-1" AS "property.&gt;2.value.&gt;1",
                          "zxc2-2-2" AS "property.&gt;2.value.&gt;2",
                          "rty2-1-1" AS "property.&gt;1.value.&gt;1.@attr",
                          "rty2-1-2" AS "property.&gt;1.value.&gt;2.@attr",
                          "rty2-2-1" AS "property.&gt;2.value.&gt;1.@attr",
                          "rty2-2-2" AS "property.&gt;2.value.&gt;2.@attr";
                     """;

  NodeChild qaXML = new XmlSlurper().parse(new File(props.outputDir+"/example/fullDealersResponse1.xml"));
  DbDiffHelper ddh = new DbDiffHelper(XmlDiffHelper.walkXmlByPath("dealer", qaXML), SqlUtil.Home.createSqlConn(props).rows(queryTest));
  ddh.calcDiff();
 </CODE>
 }</pre>
 ***********************************************************</DD></DL>
 </p>

          </li>
    </ul>
</div>

<div class="summary">
    <ul class="blockList">
        <li class="blockList">
        <!-- =========== NESTED CLASS SUMMARY =========== -->
        

        <!-- =========== ENUM CONSTANT SUMMARY =========== -->
        
        <!-- =========== FIELD SUMMARY =========== -->
        
            <ul class="blockList">
                <li class="blockList"><a name="field_summary"><!--   --></a>
                    <h3>Field Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Enum constants summary table">
                        <caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Modifiers</th>
                            <th class="colLast" scope="col">Name</th>
                            <th class="colLast" scope="col">Description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong>java.lang.String</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#ignoredValue">ignoredValue</a></code></td>
                            <td class="colLast">You can exclude some Columns or Nodes from comparison.</code></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong>java.util.Map&lt;java.lang.String, java.lang.String&gt;</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#includedNodes">includedNodes</a></code></td>
                            <td class="colLast">Sometimes it is very complicate to query DB for all parameters under same row. </code></td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong>java.lang.Boolean</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#orderlySafeArrayMode">orderlySafeArrayMode</a></code></td>
                            <td class="colLast">By default CompareNodes() function works in "NonOrderlySafe" mode. </code></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong>java.lang.Boolean</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#orderlySafeMode">orderlySafeMode</a></code></td>
                            <td class="colLast">By default CalcDiff() function works in "OrderlySafe" mode. </code></td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong>java.lang.Boolean</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#skipMissedDb">skipMissedDb</a></code></td>
                            <td class="colLast">By default system expects to run the most strict version of comparison.</code></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong>java.lang.Boolean</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#skipMissedXml">skipMissedXml</a></code></td>
                            <td class="colLast">By default system expects to run the most strict version of comparison.</code></td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong>groovy.sql.Sql</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#sql">sql</a></code></td>
                            <td class="colLast">groovy.sql.Sql class that will be used for getting data for <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/DbDiffHelper.html#includedNodes' title='DbDiffHelper.includedNodes'>DbDiffHelper.includedNodes</a></code></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong>java.lang.Boolean</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#subQueryFromFile">subQueryFromFile</a></code></td>
                            <td class="colLast">When use this class with Included SQL Queries, it may be more convenient to store SQL on disc as separate file rather than provide SQL string.
 </code></td>
                        </tr>
                        
                    </table>
                   </ul>
                </li>
                
            </ul>
        

        <!-- =========== PROPERTY SUMMARY =========== -->
        

        <!-- =========== ELEMENT SUMMARY =========== -->
        

        
        <!-- ======== CONSTRUCTOR SUMMARY ======== -->
        <ul class="blockList">
                <li class="blockList"><a name="constructor_summary"><!--   --></a>
                    <h3>Constructor Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructors Summary table">
                        <caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Constructor and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst">
                                <code><a href="#DbDiffHelper(List<NodeChild>, List<Map<String, String>>)">DbDiffHelper</a></strong>
                                (java.util.List&lt;groovy.util.slurpersupport.NodeChild&gt; xml, java.util.List&lt;java.util.Map&lt;java.lang.String, java.lang.String&gt;&gt; rows)</code><br></td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
        </ul>
        

        
        <!-- ========== METHOD SUMMARY =========== -->
        <ul class="blockList">
            
            <li class="blockList"><a name="method_summary"><!--   --></a>
                    <h3>Methods Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Methods Summary table">
                        <caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Type</th>
                            <th class="colLast" scope="col">Name and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>protected&nbsp;java.util.Map&lt;java.lang.String, java.lang.String&gt;</strong></code></td>
                            <td class="colLast"><code><strong><a href="#_addSubRowsToParentRow(List<Map<String, String>>, java.lang.String, Map<String, String>)">_addSubRowsToParentRow</a></strong>(java.util.List&lt;java.util.Map&lt;java.lang.String, java.lang.String&gt;&gt; subRows, java.lang.String prefix, java.util.Map&lt;java.lang.String, java.lang.String&gt; row)</code><br></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code>private&nbsp;java.lang.String</strong></code></td>
                            <td class="colLast"><code><strong><a href="#_cleanNewLines(java.lang.String)">_cleanNewLines</a></strong>(java.lang.String source)</code><br></td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>private&nbsp;java.lang.Boolean</strong></code></td>
                            <td class="colLast"><code><strong><a href="#_compareNodes(groovy.util.slurpersupport.NodeChild, Map<String, String>, HashMap<String, ArrayList<Integer>>, Map<String, String>, java.lang.String, java.lang.String, java.lang.Integer)">_compareNodes</a></strong>(groovy.util.slurpersupport.NodeChild node, java.util.Map&lt;java.lang.String, java.lang.String&gt; row, java.util.HashMap&lt;java.lang.String, java.util.ArrayList&lt;java.lang.Integer&gt;&gt; arrayNodes, java.util.Map&lt;java.lang.String, java.lang.String&gt; rowCopy, java.lang.String prefix = "", java.lang.String newPrefix = "", java.lang.Integer arrayKey = -1)</code><br></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code>private&nbsp;java.lang.Boolean</strong></code></td>
                            <td class="colLast"><code><strong><a href="#_isCompleteMatch(Map<String, String>)">_isCompleteMatch</a></strong>(java.util.Map&lt;java.lang.String, java.lang.String&gt; shallowCopy)</code><br></td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>private&nbsp;java.util.HashMap&lt;java.lang.String, java.util.ArrayList&lt;java.lang.Integer&gt;&gt;</strong></code></td>
                            <td class="colLast"><code><strong><a href="#_parseColumns(Map<String, String>)">_parseColumns</a></strong>(java.util.Map&lt;java.lang.String, java.lang.String&gt; row)</code><br></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code>void</strong></code></td>
                            <td class="colLast"><code><strong><a href="#calcDiff()">calcDiff</a></strong>()</code><br>Performs calculation of differences between consumed java.util.List.</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>java.lang.Boolean</strong></code></td>
                            <td class="colLast"><code><strong><a href="#compareNodes(groovy.util.slurpersupport.NodeChild, Map<String, String>, HashMap<String, ArrayList<Integer>>, Map<String, String>, java.lang.String)">compareNodes</a></strong>(groovy.util.slurpersupport.NodeChild node, java.util.Map&lt;java.lang.String, java.lang.String&gt; row, java.util.HashMap&lt;java.lang.String, java.util.ArrayList&lt;java.lang.Integer&gt;&gt; arrayNodes = null, java.util.Map&lt;java.lang.String, java.lang.String&gt; rowCopy = null, java.lang.String prefix = "")</code><br>Performs comparison between specified groovy.util.slurpersupport.NodeChild and java.util.Map.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code>java.lang.String</strong></code></td>
                            <td class="colLast"><code><strong><a href="#getDiffString(java.lang.Boolean)">getDiffString</a></strong>(java.lang.Boolean source)</code><br>Returns java.lang.String with XML that shows diff found in specified element</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>java.util.List&lt;groovy.util.slurpersupport.NodeChild&gt;</strong></code></td>
                            <td class="colLast"><code><strong><a href="#retainNodes()">retainNodes</a></strong>()</code><br>Performing Diff calculation between consumed java.util.List
 and deletion from <CODE>#source1</CODE> elements that match with second list.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code>void</strong></code></td>
                            <td class="colLast"><code><strong><a href="#setupFromConfig(java.util.Map)">setupFromConfig</a></strong>(java.util.Map params)</code><br>Automatically scans <CODE>params</CODE> for elements that match with names of <CODE>public</CODE> parameters of <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/XmlDiffHelper.html' title='XmlDiffHelper'>XmlDiffHelper</a> and assigns values to them.</td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
            
        </ul>
        
    </li>
    </ul>
</div>

<div class="details">
    <ul class="blockList">
        <li class="blockList">
           

            
            <!-- =========== FIELD DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="field_detail">
                    <!--   -->
                </a>
                    <h3>Field Detail</h3>
                    
                        <a name="ignoredValue"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.lang.String <strong>ignoredValue</strong></h4>
                                <p> You can exclude some Columns or Nodes from comparison.<br>
 Use "ignoredValue" variable to set value that will be compared with DB value.<br>
 By default ignoredValue = "ignore".<br>
 E.g. <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer IgnoredAttr="bla-bla"&gt; 
         &lt;NAME&gt;name&lt;NAME&gt; 
     &lt;/dealer&gt; 
 &lt;/data&gt; 
 SELECT "name" AS "NAME", "ignore" AS "@IgnoredAttr";
 </CODE></pre>
 Selected row and XML matches, as "IgnoredAttr" will be excluded from comparison<br>
 Accepts <CODE>Regexp</CODE> expressions
     </p>
                            </li>
                        </ul>
                    
                        <a name="includedNodes"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.util.Map&lt;java.lang.String, java.lang.String&gt; <strong>includedNodes</strong></h4>
                                <p> Sometimes it is very complicate to query DB for all parameters under same row. In SQL we have "JOIN" mechanism.<br>
 However, it is extremely hard to implement something similar in such small library.<br>
 That's why it has been proposed to replace mentioned nodes with "Included Queries".<br>
 For example:<br>
 <pre>{@code<node>
     <name>Name1</name>
     <subNode>val1</subNode>
     <subNode>val2</subNode>
 </node>
 <node>
     <name>Name2</name>
     <subNode>val1</subNode>
     <subNode>val2</subNode>
     <subNode>val3</subNode>
 </node>
 }</pre><br>
 As you can see, in provided example XML nodes has different amount of <CODE>&lt;subNode&gt;</CODE> elements.<br>
 In SQL we would have something like:<br>
 <CODE>SELECT t1.name, t2.subNode FROM Table1 AS t1 INNER JOIN Table2 AS t2 ON t1.field1 = t2.field1</CODE>
 that will result in multiple rows.<br>
 Proposed solution is:<br>
 <ul>
     <li>
          Query1:<br>
          <CODE>SELECT name, field1 AS "_field1" FROM Table1</CODE>
     </li>
     <li>
         Query2:<br>
         <CODE>SELECT * FROM Table2 WHERE field1 = :_field1</CODE>
     </li>
 </ul>
 When we have both ResultSet, system will merge them into 1 java.util.Map that will be used for XML 2 DB comparison.
 </p>
                            </li>
                        </ul>
                    
                        <a name="orderlySafeArrayMode"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.lang.Boolean <strong>orderlySafeArrayMode</strong></h4>
                                <p> By default CompareNodes() function works in "NonOrderlySafe" mode. It means, that nodes with same name under one parent<br>
 will be compared without checking order of unique identifier.<br>
 Always use this mode, if your XML may have different number of nodes with same name under one parent.<br>
 You can change that by setting <CODE>orderlySafeArrayMode == true</CODE><br>
 For example: <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer attr="val1"&gt; 
         &lt;property&gt;PreOwned&lt;property&gt; 
         &lt;property&gt;NCV&lt;property&gt;
         &lt;property&gt;Leaf&lt;property&gt;
     &lt;dealer&gt;
 &lt;/data&gt;
 SELECT
  "val1" AS "@attr"
  po.`Description` AS "property.&gt;match",
  NULL AS "property.&gt;fake"
  leaf.`Description` AS "property.&gt;1",
  ncv.`Description` AS "property.&gt;2"
 FROM DEALERS AS p
 LEFT JOIN DEALER_SPECIAL AS ncv ON ncv.DealerId = d.DealerId AND ncv.Description = "NCV"
 LEFT JOIN DEALER_SPECIAL AS leaf ON leaf.DealerId = d.DealerId AND leaf.Description = "Leaf"
 LEFT JOIN DEALER_SPECIAL AS po ON po.DealerId = d.DealerId AND po.Description = "PreOwned";
 </CODE></pre>
 <ul>
     <li>
      1)  <CODE>orderlySafeArrayMode = false; // Default</CODE><br>
          Result: Xml and DbResult match. No differences where found.<br>
     </li>
     <li>
      2)  <CODE>orderlySafeArrayMode = true;</CODE><br>
          Result: Only <property>PreOwned<property> matches. <property>NCV<property> and <property>Leaf<property> are marked as differences.<br>
     </li>
 </ul>
     </p>
                            </li>
                        </ul>
                    
                        <a name="orderlySafeMode"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.lang.Boolean <strong>orderlySafeMode</strong></h4>
                                <p> By default CalcDiff() function works in "OrderlySafe" mode. It means, that nodes in Lists will be compared in exact order.<br>
 You can change that by setting <CODE>orderlySafeMode == false</CODE><br>
 For example: <br>
 <pre><CODE>&lt;data&gt; 
     &lt;dealer attr="val1"&gt; 
     &lt;dealer attr="val2"&gt; 
     &lt;dealer attr="val3"&gt; 
 &lt;/data&gt; 
 SELECT "val2" AS "@attr" 
 UNION 
 SELECT "val1" AS "@attr" 
 UNION 
 SELECT "val3" AS "@attr"
 </CODE></pre>
 <ul>
     <li>
      1)  <CODE>orderlySafeMode = false; // Default</CODE><br>
          Result: Xml and DbResult match. No differences where found.<br>
     </li>
     <li>
      2)  <CODE>orderlySafeMode = true;</CODE><br>
          Result: Only attr="val3" matches. attr="val1" and attr="val2" are marked as differences.<br>
     </li>
 </ul>
     </p>
                            </li>
                        </ul>
                    
                        <a name="skipMissedDb"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.lang.Boolean <strong>skipMissedDb</strong></h4>
                                <p> By default system expects to run the most strict version of comparison.<br>
 It means that if XML contains node that doesn't exist in DB - system will treat that situation as difference.<br>
 However, if it is expect to test only couple DB-XML pairs instead of entire XML, you can simply skip all additional DB nodes.<br>
 Generally, this option has been added in case, when you want to skip multiple Nodes in XML.<br>
 Default value is false
 </p>
                            </li>
                        </ul>
                    
                        <a name="skipMissedXml"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.lang.Boolean <strong>skipMissedXml</strong></h4>
                                <p> By default system expects to run the most strict version of comparison.<br>
 It means that if DB result contains node that doesn't exist in XML - system will treat that situation as difference.<br>
 However, if it is expected to store more data in DB than have in XML, you can simply skip all additional DB nodes.<br>
 Default value is false
 </p>
                            </li>
                        </ul>
                    
                        <a name="sql"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;groovy.sql.Sql <strong>sql</strong></h4>
                                <p> groovy.sql.Sql class that will be used for getting data for <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/DbDiffHelper.html#includedNodes' title='DbDiffHelper.includedNodes'>DbDiffHelper.includedNodes</a>
 </p>
                            </li>
                        </ul>
                    
                        <a name="subQueryFromFile"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>public&nbsp;java.lang.Boolean <strong>subQueryFromFile</strong></h4>
                                <p> When use this class with Included SQL Queries, it may be more convenient to store SQL on disc as separate file rather than provide SQL string.
 Default value is true
 </p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            

            

            

            
            <!-- =========== CONSTRUCTOR DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="constructor_detail">
                    <!--   -->
                </a>
                    <h3>Constructor Detail</h3>
                    
                        <a name="DbDiffHelper(List<NodeChild>, List<Map<String, String>>)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><strong>DbDiffHelper</strong>(java.util.List&lt;groovy.util.slurpersupport.NodeChild&gt; xml, java.util.List&lt;java.util.Map&lt;java.lang.String, java.lang.String&gt;&gt; rows)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            


            
            <!-- =========== METHOD DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="method_detail">
                    <!--   -->
                </a>
                    <h3>Method Detail</h3>
                    
                        <a name="_addSubRowsToParentRow(List<Map<String, String>>, java.lang.String, Map<String, String>)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>protected&nbsp;java.util.Map&lt;java.lang.String, java.lang.String&gt; <strong>_addSubRowsToParentRow</strong>(java.util.List&lt;java.util.Map&lt;java.lang.String, java.lang.String&gt;&gt; subRows, java.lang.String prefix, java.util.Map&lt;java.lang.String, java.lang.String&gt; row)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="_cleanNewLines(java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>private&nbsp;java.lang.String <strong>_cleanNewLines</strong>(java.lang.String source)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="_compareNodes(groovy.util.slurpersupport.NodeChild, Map<String, String>, HashMap<String, ArrayList<Integer>>, Map<String, String>, java.lang.String, java.lang.String, java.lang.Integer)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>private&nbsp;java.lang.Boolean <strong>_compareNodes</strong>(groovy.util.slurpersupport.NodeChild node, java.util.Map&lt;java.lang.String, java.lang.String&gt; row, java.util.HashMap&lt;java.lang.String, java.util.ArrayList&lt;java.lang.Integer&gt;&gt; arrayNodes, java.util.Map&lt;java.lang.String, java.lang.String&gt; rowCopy, java.lang.String prefix = "", java.lang.String newPrefix = "", java.lang.Integer arrayKey = -1)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="_isCompleteMatch(Map<String, String>)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>private&nbsp;java.lang.Boolean <strong>_isCompleteMatch</strong>(java.util.Map&lt;java.lang.String, java.lang.String&gt; shallowCopy)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="_parseColumns(Map<String, String>)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>private&nbsp;java.util.HashMap&lt;java.lang.String, java.util.ArrayList&lt;java.lang.Integer&gt;&gt; <strong>_parseColumns</strong>(java.util.Map&lt;java.lang.String, java.lang.String&gt; row)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="calcDiff()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>calcDiff</strong>()</h4>
                                <p> Performs calculation of differences between consumed java.util.List.<br>
 Result of Diff calculation depends on parameters specified before calling this method.<br>
 Every time when called, overrides Diff and output Xml.
     </p>
                            </li>
                        </ul>
                    
                        <a name="compareNodes(groovy.util.slurpersupport.NodeChild, Map<String, String>, HashMap<String, ArrayList<Integer>>, Map<String, String>, java.lang.String)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>java.lang.Boolean <strong>compareNodes</strong>(groovy.util.slurpersupport.NodeChild node, java.util.Map&lt;java.lang.String, java.lang.String&gt; row, java.util.HashMap&lt;java.lang.String, java.util.ArrayList&lt;java.lang.Integer&gt;&gt; arrayNodes = null, java.util.Map&lt;java.lang.String, java.lang.String&gt; rowCopy = null, java.lang.String prefix = "")</h4>
                                <p> Performs comparison between specified groovy.util.slurpersupport.NodeChild and java.util.Map.<br>
 Result of comparison depends on parameters specified before calling this method.<br>
 If notifications are enabled, may create Console messages with additional info if Diff found.<br>
 Console messages may appear even if result is true. It depends on <CODE>orderlySafeArrayMode</CODE>.<br>
 If <CODE>orderlySafeArrayMode = false</CODE>, Diff could be found between 2 elements, but match may happen<br>
 with other element in future as system will continue comparison with all elements on the same level.
     <DL><DT><B>Returns:</B></DT><DD>true if params match</DD></DL><DL><DT><B>Parameters:</B></DT><DD>node</DD><DD>row</DD><DD><code>Other</code> -  parameters are optional and are used by function itself when performing recursive comparison. It is strongly suggested never use them.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="getDiffString(java.lang.Boolean)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>@java.lang.Deprecated
java.lang.String <strong>getDiffString</strong>(java.lang.Boolean source)</h4>
                                <p> Returns java.lang.String with XML that shows diff found in specified element<DL><DT><B>deprecated:</B></DT><DD>This method will not be updated anymore. May be broken in future.</DD></DL>
     <DL><DT><B>Returns:</B></DT><DD>Returns java.lang.String with XML or JSON that shows diff found in specified element</DD></DL><DL><DT><B>Parameters:</B></DT><DD><code>source</code> -     true to use <CODE>#source1</CODE>, false to use <CODE>#source2</CODE></DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="retainNodes()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>@java.lang.Deprecated
java.util.List&lt;groovy.util.slurpersupport.NodeChild&gt; <strong>retainNodes</strong>()</h4>
                                <p> Performing Diff calculation between consumed java.util.List
 and deletion from <CODE>#source1</CODE> elements that match with second list.<DL><DT><B>deprecated:</B></DT><DD>This method will not be updated anymore. May be broken in future.</DD></DL>
     <DL><DT><B>Returns:</B></DT><DD>Returns java.util.List of groovy.util.slurpersupport.NodeChild with nodes that do not match with second list.</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="setupFromConfig(java.util.Map)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>setupFromConfig</strong>(java.util.Map params)</h4>
                                <p> Automatically scans <CODE>params</CODE> for elements that match with names of <CODE>public</CODE> parameters of <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/XmlDiffHelper.html' title='XmlDiffHelper'>XmlDiffHelper</a> and assigns values to them.
     <DL><DT><B>Parameters:</B></DT><DD><code>params</code> -     java.util.Map of parameters that will be automatically mapped to <CODE>public</CODE> parameters of <a href='../../../../../../src/main/groovy/com/silly_diff/Helpers/XmlDiffHelper.html' title='XmlDiffHelper'>XmlDiffHelper</a></DD></DL></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            
        </li>
    </ul>
</div>

<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
    <!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../../index-all.html">Index</a></li>
        <li><a href="../../../../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../../../../index.html?src/main/groovy/com/silly_diff/Helpers/DbDiffHelper" target="_top">Frames</a></li>
            <li><a href="DbDiffHelper.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;<li><a href="#field_summary">Field</a></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#constructor_summary">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            <li><a href="#field_detail">Field</a></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<li><a href="#constructor_detail">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <p>Groovy Documentation</p>
    <a name="skip-navbar_bottom">
        <!--   -->
    </a>
    </div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
